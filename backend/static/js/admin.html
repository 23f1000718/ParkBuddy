<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard - ParkBuddy</title>
  <script src="https://unpkg.com/vue@3"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    .lot-card { margin-bottom: 15px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    .form-section { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; }
  </style>
</head>
<body>
  <div id="adminApp">
    <div class="container">
      <h2 class="mb-4">Admin Dashboard - ParkBuddy</h2>
      
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h4>Parking Lots</h4>
        <button @click="fetchLots" class="btn btn-primary">Reload Lots</button>
      </div>
      
      <div v-if="lots.length === 0" class="alert alert-info">
        No parking lots found. Create one below.
      </div>
      
      <div v-for="lot in lots" :key="lot.id" class="lot-card">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h5 class="mb-1">{{ lot.prime_location_name }}</h5>
            <p class="mb-1"><strong>Price:</strong> â‚¹{{ lot.price_per_hour }}/hour</p>
            <p class="mb-1"><strong>Address:</strong> {{ lot.address }}</p>
            <p class="mb-0"><strong>Total Spots:</strong> {{ lot.number_of_spots }}</p>
          </div>
          <div class="col-md-4 text-end">
            <button @click="deleteLot(lot.id)" class="btn btn-danger">Delete Lot</button>
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <h5>Add New Parking Lot</h5>
        <div class="row">
          <div class="col-md-6">
            <input v-model="newLot.name" placeholder="Lot Name" class="form-control mb-2" />
            <input v-model="newLot.price" type="number" step="0.01" placeholder="Price per hour" class="form-control mb-2" />
            <input v-model="newLot.address" placeholder="Address" class="form-control mb-2" />
          </div>
          <div class="col-md-6">
            <input v-model="newLot.pincode" placeholder="Pin Code" class="form-control mb-2" />
            <input v-model="newLot.spots" type="number" placeholder="Total Spots" class="form-control mb-2" />
            <button @click="addLot" class="btn btn-success">Create Lot</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          lots: [],
          newLot: {
            name: '', price: '', address: '', pincode: '', spots: ''
          }
        }
      },
      mounted() {
        this.fetchLots();
      },
      methods: {
        getToken() {
          return localStorage.getItem('token');
        },
        fetchLots() {
          fetch('/api/lots', {
            headers: { Authorization: `Bearer ${this.getToken()}` }
          })
          .then(res => res.json())
          .then(data => this.lots = data)
          .catch(err => console.error('Error fetching lots:', err));
        },
        deleteLot(id) {
          if (!confirm('Are you sure you want to delete this lot?')) return;
          
          fetch(`/api/admin/lots/${id}`, {
            method: 'DELETE',
            headers: { Authorization: `Bearer ${this.getToken()}` }
          })
          .then(res => res.json())
          .then(data => {
            alert(data.msg);
            this.fetchLots();
          })
          .catch(err => {
            console.error('Error deleting lot:', err);
            alert('Error deleting lot');
          });
        },
        addLot() {
          if (!this.newLot.name || !this.newLot.price || !this.newLot.spots) {
            alert('Please fill in all required fields');
            return;
          }
          
          fetch('/api/admin/lots', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${this.getToken()}`
            },
            body: JSON.stringify(this.newLot)
          })
          .then(res => res.json())
          .then(data => {
            alert(data.msg);
            this.newLot = { name: '', price: '', address: '', pincode: '', spots: '' };
            this.fetchLots();
          })
          .catch(err => {
            console.error('Error creating lot:', err);
            alert('Error creating lot');
          });
        }
      }
    }).mount('#adminApp');
  </script>
</body>
</html>
