<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ParkBuddy</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body class="p-4">
  <div id="app">
    <h2>Welcome to ParkBuddy</h2>

    <div v-if="!token">
      <h4>Login</h4>
      <input v-model="loginData.email" placeholder="Email" class="form-control mb-2" />
      <input v-model="loginData.password" type="password" placeholder="Password" class="form-control mb-2" />
      <button @click="login('user')" class="btn btn-primary me-2">User Login</button>
      <button @click="login('admin')" class="btn btn-secondary">Admin Login</button>
    </div>

    <div v-else>
      <h4>You are logged in as: {{ role }}</h4>
      <button @click="logout" class="btn btn-danger mb-3">Logout</button>
      <div v-if="role === 'user'">
        <iframe src="/static/js/user.html" width="100%" height="500px" frameborder="0"></iframe>
      </div>
      <div v-else-if="role === 'admin'">
        <iframe src="/static/js/admin.html" width="100%" height="500px" frameborder="0"></iframe>
      </div>
    </div>
  </div>

  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          token: localStorage.getItem('token'),
          role: localStorage.getItem('role'),
          loginData: { email: '', password: '' },
        };
      },
      methods: {
        login(type) {
          const url = type === 'admin'
            ? '/api/auth/admin/login'
            : '/api/auth/login';
          fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(this.loginData)
          })
          .then(res => res.json())
          .then(data => {
            if (data.access_token) {
              this.token = data.access_token;
              this.role = type;
              localStorage.setItem('token', data.access_token);
              localStorage.setItem('role', type);
            } else {
              alert(data.msg || 'Login failed');
            }
          });
        },
        logout() {
          localStorage.clear();
          this.token = null;
          this.role = null;
        }
      }
    }).mount('#app');
  </script>
</body>
</html>
